select u.id as idprofessor, concat(u.firstname, ' ', u.lastname) as professor, c.id as courseid, c.fullname as curso, count(alunos.id) as alunos, case when casa.value = '1' then 'SENAI' when casa.value = '2' then 'SESI' when casa.value = '3' then 'IEL' when casa.value = '4' then 'FIEP' else 'Não Informado' end as casa, case when mediacao.value = '1' then 'Autoinstrucional' when mediacao.value = '2' then 'Tutoria ativa' when mediacao.value = '3' then 'Tutoria receptiva' else 'Não Informado' end as mediacao, case when carga_horaria.value is null or carga_horaria.value = '' then 'Não informado' else carga_horaria.value end as carga_horaria, case when modalidade.value = '1' then '100% online' when modalidade.value = '2' then 'Semipresencial' when modalidade.value = '3' then 'Presencial' else 'Não informado' end as modalidade, case when nivel_instrucao.value = '1' then 'Aperfeiçoamento' when nivel_instrucao.value = '2' then 'Qualificação (Senai)' when nivel_instrucao.value = '3' then 'Aprendizagem (Senai)' when nivel_instrucao.value = '4' then 'Técnico (Senai)' when nivel_instrucao.value = '5' then 'Graduação (Senai e IEL)' when nivel_instrucao.value = '6' then 'EJA anos finais (Sesi)' when nivel_instrucao.value = '7' then 'Ensino Médio (SESI)' when nivel_instrucao.value = '8' then 'Educação continuada (Sesi)' when nivel_instrucao.value = '9' then 'Pós graduação (IEL)' else 'Não informado' end as nivel_instrucao from mdl_user u inner join mdl_role_assignments ra on ra.userid = u.id and ra.roleid = 3 inner join mdl_context ct on ct.contextlevel = 50 and ct.id = ra.contextid inner join mdl_course c on c.id = ct.instanceid left join mdl_customfield_data casa on casa.fieldid = 5 and casa.instanceid = c.id left join mdl_customfield_data mediacao on mediacao.fieldid = 8 and mediacao.instanceid = c.id left join mdl_customfield_data carga_horaria on carga_horaria.fieldid = 9 and carga_horaria.instanceid = c.id left join mdl_customfield_data modalidade on modalidade.fieldid = 7 and modalidade.instanceid = c.id left join mdl_customfield_data nivel_instrucao on nivel_instrucao.fieldid = 6 and nivel_instrucao.instanceid = c.id inner join ( select u2.id, ra2.contextid from mdl_user u2 inner join mdl_role_assignments ra2 on ra2.userid = u2.id and ra2.roleid = 5 inner join mdl_context ct2 on ct2.id = ra2.contextid and ct2.contextlevel = 50 inner join mdl_enrol e on e.courseid = ct2.instanceid and e.enrol = 'manual' inner join mdl_user_enrolments ue on ue.userid = u2.id and ue.enrolid = e.id and ue.status = 0) as alunos on alunos.contextid = ct.id group by idprofessor, professor, courseid, curso, casa, mediacao, carga_horaria, modalidade, nivel_instrucao
